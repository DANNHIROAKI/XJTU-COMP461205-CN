[TOC]

# 第五章——数据链路层

## 5.4 交换局域网

### 5.4.3 数据链路层设备

#### Hub集线器

Hub集线器：**物理层设备**，<mark>不能隔离碰撞域</mark>——节点越多，碰撞域越大

集线器是一种物理层设备，作用于比特，当表示一个0或者一个1的比特到达一个接口时，集线器重新生成这个比特，将其能量放大，然后将其向所有其他接口传输出去

也是一种广播局域网，如果同时收到两个不同的接口的帧，会发生碰撞，节点需要重新传输帧

没有CSMA/CD，没有帧缓冲

#### 交换机

:one: 链路层设备:比Hubs更智能，更主动

> 存储、转发以太网帧
>
> 检查传入帧的MAC地址，有选择地将帧转发到一个或多个输出链路;当帧在段上转发时，使用CSMA/CD访问段
>

:two: 透明的：主机不知道交换机的存在

:three: 即插即用,自学习：交换机无需配置

##### 帧过滤和转发——记住算法

**过滤(iltering)**是决定一个帧应该转发到某个接口还是应当将其丢弃的交换机功能。

**转发(forwarding)**是决定一个帧应该被导向哪个接口，并把该帧移动到那些接口的交换机功能。

交换机的过滤和转发借助于**交换机表(switch table)**完成。该交换机表包含某局域网上某些主机和路由器的但不必是全部的表项。交换机表中的一个表项包含：

> ①一个MAC地址
>
> ②通向该MAC地址的交换机接口
>
> ③表项放置在表中的时间。

![image-20220502212448883](https://note-image-1307786938.cos.ap-beijing.myqcloud.com/typora/image-20220502212448883.png)


为了理解交换机过滤和转发的工作过程，假定目的地址为`DD-DD-DD-DD-DD-DD`的帧从交换机接口x到达。交换机用MAC地址`DD-DD-DD-DD-DD-DD`索引它的表。有3种可能的情况：

:one: 表中没有对于`DD-DD-DD-DD-DD-DD`的表项。在这种情况下，交换机向除接口x外的所有接口前面的输出缓存转发该帧的副本。换言之，如果没有对于目的地址的表项，交换机广播该帧（flooding）

:two: 表中有一个表项将`DD-DD-DD-DD-DD-DD`与接口x联系起来(这里的意思是说`DD-DD-DD-DD-DD-DD`的主机本来就在这个局域网中)。在这种情况下，该帧从包括适配器`DD-DD-DD-DD-DD-DD`的局域网网段到来。无须将该帧转发到任何其他接口，交换机通过丢弃该帧**执行过滤功能即可**。

:three: 表中有一个表项将`DD-DD-DD-DD-DD-DD`与接口y≠x联系起来。在这种情况下，该帧需要被**转发到与接口y相连的局域网网段**。交换机通过将该帧放到接口y前面的输出缓存完成转发功能。

<mark>过滤转发算法</mark>

```c
When frame received:
1. record link associated with sending host(self-learning)
2. index switch table using MAC dest address
3. if entry found for destination
   then {
     if dest on segment from which frame arrived
     then drop the frame
     else {
     	CSMA/CD
        forward the frame on interface indicated
     }
    }   
    else {
    	CSMA/CD
    	flood
    }
当接收到帧:
1. 通过自学习记录与发送主机关联的链路，在交换表中添加表项;
2. 使用帧中的目的MAC地址索引交换表表项;
3. if(使用目的MAC地址找到相应表项){
		if(该表项中的接口与该帧到达的交换机的接口一致)//即目的主机与源主机位于同一个网段
		{
			丢弃该帧;
		}else{
			执行CSMA/CD算法;
			将该帧转发到相应的接口;
		}
	}else{
		执行CSMA/CD算法;
		交换机广播该帧;
	}
```

##### 自学习

交换机具有自学习性：它的交换表是**自动、动态和自治地**建立的，即没有来自网络管理员或来自配置协议的任何干预。

这种能力是以如下方式实现的：

:one: 交换机表初始为空。

:two: 对于在每个接口接收到的每个入帧，该交换机在其表中存储：

> ①在该帧源地址字段中的MAC地址；
>
> ②该帧到达的接口；
>
> ③当前时间。

交换机以这种方式在它的表中记录了**发送节点所在的局域网网段**。如果在局域网上的每个主机最终都发送了一个帧，**则每个主机最终将在这张表中留有记录**。

:three: 如果在一段时间（称为老化期(aging time)后，交换机没有接收到以该地址作为源地址的帧，就在表中删除这个地址。以这种方式，如果一台PC被另一台PC（具有不同的适配器)代替，原来PC的MAC地址将最终从该交换机表中被清除掉。

假设在时刻9:39，源地址为`01-12-23-34-45-56`的一个帧从接口2到达。假设这个地址不在交换机表中。于是交换机在其表中增加一个新的表项，如图中所示假设该交换机的老化期是60min，在9:32~10:32期间源地址是`62-FE-F7-11-89-A3`的帧没有到达该交换机。那么在时刻10:32，这台交换机将从它的表中删除该地址。

![image-20220502213727337](https://note-image-1307786938.cos.ap-beijing.myqcloud.com/typora/image-20220502213727337.png)

##### 互联交换机

交换机可以互联在一起

![image-20220414172424610](https://gitee.com/yi-junquan/image_gitee/raw/master/images/image-20220414172424610.png)

采集进出局域网的所有链路：**端口镜像**

#### 交换机与路由器比较

两者都是存储转发互连设备，都能隔离碰撞域

> 路由器:网络层设备(检查网络层报头)
>
> 交换机:是链路层设备
>

路由器维护路由表，实现路由算法

交换机维护交换表，实现**CSMA/CD，过滤和转发，自学习算法**

